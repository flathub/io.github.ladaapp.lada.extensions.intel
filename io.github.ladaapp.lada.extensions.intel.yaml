id: io.github.ladaapp.lada.extensions.intel
runtime: io.github.ladaapp.lada
runtime-version: 'beta'
sdk: org.gnome.Sdk//49
build-extension: true
separate-locales: false
modules:
  - name: intel-graphics-compiler
    buildsystem: cmake-ninja
    build-options:
      env:
        GIT_COMMITTER_NAME: 'builduser'
        GIT_COMMITTER_EMAIL: 'builduser@example.com'
    config-opts:
      - -DCCLANG_FROM_SYSTEM=OFF
      - -DCMAKE_BUILD_TYPE=Release
      - -DCMAKE_POLICY_VERSION_MINIMUM=3.5.0
      - -DCMAKE_SKIP_RPATH=YES
      - -DIGC_OPTION__CLANG_MODE=Source
      - -DIGC_OPTION__LINK_KHRONOS_SPIRV_TRANSLATOR=ON
      - -DIGC_OPTION__LLD_MODE=Source
      - -DIGC_OPTION__LLVM_MODE=Source
      - -DIGC_OPTION__LLVM_PREFERRED_VERSION=16.0.6
      - -DIGC_OPTION__SPIRV_TOOLS_MODE=Source
      - -DIGC_OPTION__VC_INTRINSICS_MODE=Source
      - -DIGC_OPTION__USE_PREINSTALLED_SPIRV_HEADERS=OFF
      - -Wno-dev
    builddir: true
    subdir: igc
    sources:
      - type: git
        url: https://github.com/intel/intel-graphics-compiler
        tag: v2.27.10
        dest: igc
      - type: git
        url: https://github.com/intel/vc-intrinsics.git
        tag: v0.24.2
        dest: vc-intrinsics
      - type: git
        url: https://github.com/KhronosGroup/SPIRV-Tools.git
        commit: 28a883ba4c67f58a9540fb0651c647bb02883622
        dest: SPIRV-Tools
      - type: git
        url: https://github.com/KhronosGroup/SPIRV-Headers.git
        commit: 01e0577914a75a2569c846778c2f93aa8e6feddd
        dest: SPIRV-Headers
      - type: git
        url: https://github.com/llvm/llvm-project.git
        tag: llvmorg-16.0.6
        commit: 7cbf1a2591520c2491aa35339f227775f4d3adf6
        dest: llvm-project
      - type: git
        url: https://github.com/intel/opencl-clang.git
        commit: 6ab2da341420eba7d022a85a5190c46133347719
        dest: llvm-project/llvm/projects/opencl-clang
      - type: git
        url: https://github.com/KhronosGroup/SPIRV-LLVM-Translator.git
        commit: ee2a14e38f24c422cf1f0375b5b9cec0afe4412c
        dest: llvm-project/llvm/projects/llvm-spirv
      - type: patch
        path: 010-intel-graphics-compiler-disable-werror.patch
      - type: patch
        path: gcc15-llvm-header-fixes.patch
      - type: shell
        commands:
          - ln -s "SPIRV-Headers" "llvm-project/llvm/projects/SPIRV-Headers"
